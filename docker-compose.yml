services:
  log-analytics:
    build:
      context: .
      dockerfile: Dockerfile

    ports:
      - "8080:8080"

    # Persist file storage (config uses ./.tmp/file-storage; WORKDIR=/app -> /app/.tmp/file-storage)
    volumes:
      - ./.tmp:/app/.tmp

    restart: unless-stopped

    # Healthcheck without wget/curl: TCP port check using nc (requires busybox-extras in the image)
    healthcheck:
      test: ["CMD", "sh", "-c", "nc -z localhost 8080 || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
